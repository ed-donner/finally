# Technology Stack

**Analysis Date:** 2026-02-11

## Languages

**Primary:**
- Python 3.12+ - Backend API server, market data processing, LLM integration
- TypeScript/JavaScript - Frontend UI (Next.js) and E2E tests (Playwright)

**Secondary:**
- SQL - SQLite schema definitions and migrations
- Bash/PowerShell - Docker container lifecycle scripts

## Runtime

**Environment:**
- Python 3.12 (backend)
- Node 20+ (frontend build)
- Docker (container runtime)

**Package Managers:**
- `uv` - Python dependency management (backend)
- `npm` - JavaScript dependency management (frontend)
- Lockfiles: `uv.lock` (backend), `package-lock.json` (frontend assumed)

## Frameworks

**Backend:**
- FastAPI 0.128.7+ - REST API, SSE streaming, request validation
- Uvicorn 0.32.0+ - ASGI server for FastAPI

**Frontend:**
- Next.js - React-based application framework with static export
- TypeScript - Type safety for frontend code
- Tailwind CSS - Utility-first CSS framework

**Testing:**
- pytest 8.3.0+ - Python unit/integration testing
- pytest-asyncio 0.24.0+ - Async test support for FastAPI
- pytest-cov 5.0.0+ - Code coverage analysis
- Playwright - E2E browser testing (installed in `test/`)

## Key Dependencies

**Critical:**
- FastAPI 0.128.7+ - Core HTTP framework; powers all REST endpoints and SSE streaming
- Starlette (FastAPI dependency) - ASGI toolkit for request/response handling
- Pydantic - Data validation and serialization (FastAPI dependency)
- Uvicorn[standard] 0.32.0+ - Production ASGI server with uvloop and httptools

**Market Data:**
- massive 1.0.0+ - Polygon.io REST API client for real market data (optional)
- numpy 2.0.0+ - Numerical computing for GBM simulator correlated price generation

**Utilities:**
- rich 13.0.0+ - Terminal/CLI output formatting
- python-dotenv - Environment variable loading from `.env` files

**Development:**
- ruff 0.7.0+ - Fast Python linter and formatter (replaces black/flake8)
- Coverage 7.13.4+ - Code coverage measurement

## Configuration

**Environment:**
- `.env` file (gitignored, `.env.example` provided) - Configuration loading
- Environment variables read at startup and used throughout backend
- Docker container receives `.env` via `--env-file` flag

**Key Configuration Points:**
- `OPENROUTER_API_KEY` - LLM integration (required for chat)
- `MASSIVE_API_KEY` - Real market data (optional; simulator used if missing)
- `LLM_MOCK` - Mock LLM responses for testing (default: false)

**Build:**
- `backend/pyproject.toml` - Python project metadata, dependencies, tool configs
- `pyproject.toml` sections: `[project]`, `[project.optional-dependencies]`, `[tool.pytest.ini_options]`, `[tool.ruff]`, `[tool.coverage.run]`
- `backend/uv.lock` - Reproducible Python dependency lock (generated by `uv`)

## Platform Requirements

**Development:**
- Python 3.12 with uv
- Node 20+ with npm
- Docker (for full container build/run)
- Bash or PowerShell (for start/stop scripts)

**Production:**
- Docker container deployment
- Port 8000 exposed for HTTP traffic
- Docker named volume `finally-data` for SQLite persistence
- Single-container model: frontend served statically by FastAPI backend

**Deployment Targets:**
- Single Docker container (can run anywhere Docker is available)
- Designed for easy deployment to: AWS App Runner, Render, Docker Hub, or local Docker
- No external dependencies beyond Docker (SQLite is embedded)

## Database

**Type:**
- SQLite 3 (embedded, no separate server needed)

**Location:**
- Runtime: `/app/db/finally.db` inside container
- Host: volume-mounted directory `db/` at project root
- Persistence: Docker named volume `finally-data`

**Access:**
- No explicit ORM; raw SQL via Python `sqlite3` module or via app abstraction
- Lazy initialization: schema created automatically on first request if missing
- Multi-table structure: `users_profile`, `watchlist`, `positions`, `trades`, `portfolio_snapshots`, `chat_messages`

## API Clients & External Libraries

**HTTP Client:**
- urllib3 (via massive library) - Underlying HTTP transport
- Requests patterns via async/await in FastAPI/Starlette

**Data Formats:**
- JSON - All API responses and SSE events
- Pydantic models - Type-safe request/response schemas

**Async/Await:**
- asyncio - Python standard library async runtime (used throughout FastAPI)
- anyio 4.12.1+ - Async compatibility layer

## Build & Deployment Artifacts

**Docker Image:**
- Multi-stage Dockerfile: Node 20 slim → Python 3.12 slim
- Stage 1: Builds Next.js frontend → static export
- Stage 2: Installs uv, Python dependencies, copies frontend build, runs FastAPI

**Output:**
- Single Docker image containing:
  - Python 3.12 runtime + FastAPI server + app code
  - Static frontend files (from Next.js build)
  - SQLite binary (standard in Python)

---

*Stack analysis: 2026-02-11*
