---
phase: 06-frontend-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/next.config.ts
  - frontend/postcss.config.mjs
  - frontend/tsconfig.json
  - frontend/src/app/globals.css
  - frontend/src/app/layout.tsx
  - frontend/src/app/page.tsx
  - frontend/src/components/layout/Header.tsx
  - frontend/src/components/layout/TerminalGrid.tsx
  - frontend/src/components/panels/WatchlistPanel.tsx
  - frontend/src/components/panels/ChartPanel.tsx
  - frontend/src/components/panels/PortfolioPanel.tsx
  - frontend/src/components/panels/ChatPanel.tsx
  - frontend/src/components/ui/ConnectionDot.tsx
  - frontend/src/stores/price-store.ts
  - frontend/src/stores/portfolio-store.ts
  - frontend/src/hooks/use-price-stream.ts
  - frontend/src/lib/api.ts
autonomous: true

must_haves:
  truths:
    - "Page renders a dark terminal layout with #0d1117/#1a1a2e backgrounds and muted borders"
    - "Header displays portfolio total value updating from API data"
    - "Header displays cash balance from portfolio API"
    - "Header shows connection status dot: green when SSE connected, yellow when reconnecting, red when disconnected"
    - "SSE connection to /api/stream/prices established on page load"
    - "SSE connection auto-reconnects after disconnection via native EventSource retry"
    - "Layout shows placeholder regions for watchlist, chart area, portfolio area, and chat panel on desktop-width screen"
    - "Color scheme uses accent yellow (#ecad0a), blue primary (#209dd7), purple secondary (#753991)"
  artifacts:
    - path: "frontend/src/app/globals.css"
      provides: "Tailwind v4 @theme with terminal colors, brand colors, fonts"
      contains: "@theme"
    - path: "frontend/src/app/layout.tsx"
      provides: "Root layout with Inter + JetBrains Mono fonts, dark body"
      contains: "RootLayout"
    - path: "frontend/src/app/page.tsx"
      provides: "Single-page trading terminal assembling all layout components"
      contains: "usePriceStream"
    - path: "frontend/src/stores/price-store.ts"
      provides: "Zustand store for SSE price data and connection status"
      exports: ["usePriceStore"]
    - path: "frontend/src/stores/portfolio-store.ts"
      provides: "Zustand store for portfolio data from REST API"
      exports: ["usePortfolioStore"]
    - path: "frontend/src/hooks/use-price-stream.ts"
      provides: "SSE EventSource hook writing to Zustand price store"
      exports: ["usePriceStream"]
    - path: "frontend/src/components/layout/Header.tsx"
      provides: "Header with portfolio value, cash, connection dot"
      contains: "ConnectionDot"
    - path: "frontend/src/components/layout/TerminalGrid.tsx"
      provides: "CSS Grid layout for terminal panels"
      contains: "grid"
    - path: "frontend/next.config.ts"
      provides: "Static export configuration"
      contains: "output: 'export'"
  key_links:
    - from: "frontend/src/app/page.tsx"
      to: "frontend/src/hooks/use-price-stream.ts"
      via: "usePriceStream() call in page component"
      pattern: "usePriceStream"
    - from: "frontend/src/hooks/use-price-stream.ts"
      to: "frontend/src/stores/price-store.ts"
      via: "setPrices and setConnectionStatus writes"
      pattern: "usePriceStore"
    - from: "frontend/src/hooks/use-price-stream.ts"
      to: "/api/stream/prices"
      via: "new EventSource('/api/stream/prices')"
      pattern: "EventSource.*api/stream/prices"
    - from: "frontend/src/components/layout/Header.tsx"
      to: "frontend/src/stores/portfolio-store.ts"
      via: "usePortfolioStore selectors for cash and total value"
      pattern: "usePortfolioStore"
    - from: "frontend/src/components/ui/ConnectionDot.tsx"
      to: "frontend/src/stores/price-store.ts"
      via: "usePriceStore selector for connectionStatus"
      pattern: "usePriceStore.*connectionStatus"
    - from: "frontend/src/stores/portfolio-store.ts"
      to: "/api/portfolio"
      via: "fetch call to load portfolio data"
      pattern: "fetch.*api/portfolio"
---

<objective>
Bootstrap the Next.js frontend project and build a dark, Bloomberg-inspired terminal layout shell with live SSE price streaming and portfolio data flowing into application state.

Purpose: Establish the frontend foundation that all subsequent UI phases (watchlist, portfolio viz, chat) will build upon. This creates the visual shell, the real-time data pipeline, and the state management layer.

Output: A static-export Next.js app with Tailwind v4 dark theme, CSS Grid terminal layout with placeholder panels, Zustand stores for prices and portfolio, SSE connection with auto-reconnect, and a header showing live portfolio value, cash balance, and connection status.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-frontend-foundation/06-RESEARCH.md
@backend/app/market/stream.py
@backend/app/portfolio/models.py
@backend/app/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js project with Tailwind v4 dark theme and CSS Grid terminal layout</name>
  <files>
    frontend/package.json
    frontend/next.config.ts
    frontend/postcss.config.mjs
    frontend/tsconfig.json
    frontend/src/app/globals.css
    frontend/src/app/layout.tsx
    frontend/src/components/layout/TerminalGrid.tsx
    frontend/src/components/panels/WatchlistPanel.tsx
    frontend/src/components/panels/ChartPanel.tsx
    frontend/src/components/panels/PortfolioPanel.tsx
    frontend/src/components/panels/ChatPanel.tsx
  </files>
  <action>
    1. Scaffold the Next.js project:
       ```bash
       npx create-next-app@latest frontend --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --turbopack
       ```
       Answer "No" to any prompts about initializing a git repo (already in one).

    2. Install Zustand:
       ```bash
       cd frontend && npm install zustand
       ```

    3. Configure static export in `frontend/next.config.ts`:
       ```typescript
       import type { NextConfig } from 'next'
       const nextConfig: NextConfig = {
         output: 'export',
         images: { unoptimized: true },
       }
       export default nextConfig
       ```

    4. Ensure `frontend/postcss.config.mjs` uses `@tailwindcss/postcss` (Tailwind v4):
       ```javascript
       const config = {
         plugins: {
           "@tailwindcss/postcss": {},
         },
       }
       export default config
       ```
       If create-next-app generated a different postcss config, replace it with this.

    5. Set up the dark terminal theme in `frontend/src/app/globals.css`. Replace all generated content with:
       ```css
       @import "tailwindcss";

       @theme {
         --color-terminal-bg: #0d1117;
         --color-terminal-surface: #1a1a2e;
         --color-terminal-border: #2d2d44;

         --color-accent-yellow: #ecad0a;
         --color-brand-blue: #209dd7;
         --color-brand-purple: #753991;

         --color-price-up: #22c55e;
         --color-price-down: #ef4444;
         --color-text-primary: #e6edf3;
         --color-text-secondary: #8b949e;
         --color-text-muted: #484f58;

         --font-mono: 'JetBrains Mono', ui-monospace, monospace;
         --font-sans: 'Inter', ui-sans-serif, sans-serif;
       }
       ```

    6. Create `frontend/src/app/layout.tsx` with Inter and JetBrains Mono via next/font/google:
       - Import both fonts with `variable` prop for CSS variable injection
       - Apply both font variables to `<html>` className
       - Set `<body>` className: `bg-terminal-bg text-text-primary font-sans antialiased`
       - Metadata: title "FinAlly - AI Trading Workstation"
       - `<html lang="en">` with no dark class needed (always dark)

    7. Create `frontend/src/components/layout/TerminalGrid.tsx` -- a 'use client' component:
       - CSS Grid layout using Tailwind classes
       - 12-column grid with `gap-px` (1px gaps, filled by background color to create muted borders)
       - Height: `h-[calc(100vh-3rem)]` to leave room for header
       - Background: `bg-terminal-border` (the gap color creates the border effect)
       - Named regions via className assignments on children:
         - Watchlist: `col-span-3 row-span-2` (left column, full height)
         - Chart: `col-span-6` (center top)
         - Portfolio: `col-span-3 col-start-4` (center bottom left, 3 cols)
         - Positions/Trade: `col-span-3` (center bottom right, 3 cols)
         - Chat: `col-span-3 row-span-2` (right column, full height)
       - Each region gets `bg-terminal-surface` background

    8. Create 4 placeholder panel components in `frontend/src/components/panels/`:
       - `WatchlistPanel.tsx`: 'use client', renders a div with panel title "WATCHLIST" in `text-text-muted font-mono text-xs uppercase tracking-wider`, centered vertically and horizontally. Dark surface background.
       - `ChartPanel.tsx`: Same pattern, title "CHART"
       - `PortfolioPanel.tsx`: Same pattern, title "PORTFOLIO"
       - `ChatPanel.tsx`: Same pattern, title "CHAT"
       Each panel is a simple div with `h-full w-full p-3 bg-terminal-surface` and the label.

    9. Verify the build works:
       ```bash
       cd frontend && npm run build
       ```
       This should produce static output in `frontend/out/`. Fix any build errors before proceeding.
  </action>
  <verify>
    Run `cd frontend && npm run build` -- should complete with no errors and produce files in `frontend/out/`.
    Check `frontend/out/index.html` exists.
    Run `ls frontend/out/` to confirm static export output.
  </verify>
  <done>
    Next.js project scaffolded with static export config, Tailwind v4 dark theme with all terminal/brand colors defined in @theme, CSS Grid terminal layout with 5 placeholder panels (watchlist, chart, portfolio, positions, chat), and the project builds successfully to static output.
  </done>
</task>

<task type="auto">
  <name>Task 2: Zustand stores, SSE hook, portfolio fetch, and Header with live data</name>
  <files>
    frontend/src/stores/price-store.ts
    frontend/src/stores/portfolio-store.ts
    frontend/src/hooks/use-price-stream.ts
    frontend/src/lib/api.ts
    frontend/src/components/layout/Header.tsx
    frontend/src/components/ui/ConnectionDot.tsx
    frontend/src/app/page.tsx
  </files>
  <action>
    1. Create `frontend/src/stores/price-store.ts` -- Zustand store for SSE price data:
       ```typescript
       import { create } from 'zustand'

       type ConnectionStatus = 'connected' | 'connecting' | 'disconnected'

       interface PriceUpdate {
         ticker: string
         price: number
         previous_price: number
         timestamp: number
         change: number
         change_percent: number
         direction: 'up' | 'down' | 'flat'
       }

       interface PriceStore {
         prices: Record<string, PriceUpdate>
         connectionStatus: ConnectionStatus
         setPrices: (prices: Record<string, PriceUpdate>) => void
         setConnectionStatus: (status: ConnectionStatus) => void
       }

       export const usePriceStore = create<PriceStore>()((set) => ({
         prices: {},
         connectionStatus: 'disconnected',
         setPrices: (prices) => set({ prices }),
         setConnectionStatus: (status) => set({ connectionStatus: status }),
       }))

       export type { PriceUpdate, ConnectionStatus }
       ```

    2. Create `frontend/src/stores/portfolio-store.ts` -- Zustand store for portfolio REST data:
       ```typescript
       import { create } from 'zustand'

       interface PortfolioStore {
         cashBalance: number
         totalValue: number
         loading: boolean
         fetchPortfolio: () => Promise<void>
       }

       export const usePortfolioStore = create<PortfolioStore>()((set) => ({
         cashBalance: 0,
         totalValue: 0,
         loading: true,
         fetchPortfolio: async () => {
           try {
             const res = await fetch('/api/portfolio')
             if (res.ok) {
               const data = await res.json()
               set({
                 cashBalance: data.cash_balance,
                 totalValue: data.total_value,
                 loading: false,
               })
             }
           } catch {
             // Portfolio fetch failed -- will retry on next interval or user action
           }
         },
       }))
       ```
       Keep this store minimal -- later phases will expand it with positions, history, etc.

    3. Create `frontend/src/lib/api.ts` -- typed fetch helpers (minimal for now):
       ```typescript
       export const API_BASE = '/api'

       export async function fetchJson<T>(path: string): Promise<T> {
         const res = await fetch(`${API_BASE}${path}`)
         if (!res.ok) throw new Error(`API error: ${res.status}`)
         return res.json()
       }
       ```

    4. Create `frontend/src/hooks/use-price-stream.ts` -- SSE EventSource hook:
       - 'use client' directive at top
       - Import useEffect, useRef from react
       - Import usePriceStore selectors: setPrices, setConnectionStatus
       - In useEffect:
         - Create `new EventSource('/api/stream/prices')`
         - `es.onopen`: set status to 'connected'
         - `es.onmessage`: parse JSON data, call setPrices with parsed Record<string, PriceUpdate>
         - `es.onerror`: set status to 'disconnected', then check `es.readyState === EventSource.CONNECTING` -- if so, set to 'connecting' (browser is auto-reconnecting per the server's `retry: 1000` directive). Do NOT call es.close() -- let EventSource handle reconnection natively.
         - Store ref to EventSource for cleanup
         - Return cleanup function that calls `es.close()`
       - Export the hook as `usePriceStream`

    5. Create `frontend/src/components/ui/ConnectionDot.tsx`:
       - 'use client' component
       - Read `connectionStatus` from usePriceStore via selector: `usePriceStore((s) => s.connectionStatus)`
       - Render a small dot (h-2 w-2 rounded-full) with color:
         - connected: `bg-green-500`
         - connecting: `bg-yellow-500 animate-pulse`
         - disconnected: `bg-red-500`
       - Next to dot, show status text in `text-xs text-text-secondary capitalize`

    6. Create `frontend/src/components/layout/Header.tsx`:
       - 'use client' component
       - Height: `h-12` (3rem, matching the terminal grid offset)
       - Background: `bg-terminal-bg`, bottom border: `border-b border-terminal-border`
       - Left section: App name "FinAlly" in `text-accent-yellow font-mono font-bold`
       - Center section: Portfolio total value formatted as currency (e.g., "$10,000.00"), label "PORTFOLIO VALUE" in `text-text-muted text-xs uppercase`
       - Right-center section: Cash balance formatted as currency, label "CASH" in same muted style
       - Far right: ConnectionDot component
       - Read from `usePortfolioStore` via selectors: `totalValue`, `cashBalance`, `loading`
       - When loading is true, show placeholder dashes instead of values
       - Use `Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' })` for formatting
       - Layout: flex with justify-between, items-center, px-4

    7. Update `frontend/src/app/page.tsx` to assemble everything:
       - 'use client' directive
       - Import and call `usePriceStream()` at top of component (establishes SSE connection)
       - Import `usePortfolioStore` and call `fetchPortfolio` in a useEffect on mount
       - Render Header at top
       - Render TerminalGrid containing the placeholder panels in their grid positions
       - Structure:
         ```
         <div className="h-screen flex flex-col bg-terminal-bg">
           <Header />
           <TerminalGrid>
             <WatchlistPanel />  {/* col-span-3 row-span-2 */}
             <ChartPanel />      {/* col-span-6 */}
             <ChatPanel />       {/* col-span-3 row-span-2 */}
             <PortfolioPanel />  {/* col-span-3 */}
             <div className="col-span-3 bg-terminal-surface p-3">
               <span className="text-text-muted font-mono text-xs uppercase tracking-wider">Positions</span>
             </div>
           </TerminalGrid>
         </div>
         ```
       - Note: The grid column assignments should be on the children inside TerminalGrid, either via the panel components themselves or via wrapper divs in page.tsx. Use wrapper divs in page.tsx for flexibility -- each panel wrapped in a div with the appropriate col-span/row-span classes and `bg-terminal-surface`.

    8. Verify build still works after all additions:
       ```bash
       cd frontend && npm run build
       ```
       Fix any TypeScript or build errors. The build should succeed even though the backend API isn't available -- the SSE hook and portfolio fetch will fail gracefully at runtime (no data, disconnected state).
  </action>
  <verify>
    Run `cd frontend && npm run build` -- should complete with no errors.
    Run `ls frontend/out/index.html` -- should exist.
    Visually inspect (or grep) `frontend/out/index.html` to confirm it contains the bundled app.
    Check that all store files exist: `ls frontend/src/stores/price-store.ts frontend/src/stores/portfolio-store.ts`
    Check that hook exists: `ls frontend/src/hooks/use-price-stream.ts`
  </verify>
  <done>
    Zustand price store holds SSE price data and connection status. Zustand portfolio store fetches and holds cash balance and total value from /api/portfolio. SSE hook uses native EventSource to connect to /api/stream/prices, writes to price store, and tracks connection status (connected/connecting/disconnected) without custom reconnection logic. Header component displays portfolio total value, cash balance, and connection status dot (green/yellow/red). Page component wires everything together: SSE stream starts on mount, portfolio data fetched on mount, full terminal layout renders with all panels. Static export builds successfully.
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` completes without errors
2. `frontend/out/index.html` exists and contains bundled JavaScript
3. All required files exist:
   - `frontend/next.config.ts` contains `output: 'export'`
   - `frontend/src/app/globals.css` contains `@theme` with terminal colors
   - `frontend/src/stores/price-store.ts` exports `usePriceStore`
   - `frontend/src/hooks/use-price-stream.ts` contains `EventSource('/api/stream/prices')`
   - `frontend/src/components/layout/Header.tsx` exists
   - `frontend/src/components/ui/ConnectionDot.tsx` exists
4. Integration test (optional, requires running backend): Start backend with `cd backend && uv run uvicorn app.main:app`, copy `frontend/out/*` to `backend/static/`, visit `http://localhost:8000` -- should see dark terminal layout with red connection dot (initially disconnected, then green once SSE connects)
</verification>

<success_criteria>
- The page renders a dark terminal layout with #0d1117/#1a1a2e backgrounds and muted #2d2d44 borders
- The header shows portfolio total value, cash balance, and a connection status dot (green/yellow/red)
- SSE connection to /api/stream/prices is established on page load via native EventSource
- SSE automatically reconnects after disconnection (EventSource built-in retry, no custom logic)
- Layout contains visible placeholder regions for watchlist, chart, portfolio, and chat on a desktop-width screen
- Color scheme uses accent yellow (#ecad0a), blue primary (#209dd7), purple secondary (#753991) as defined in Tailwind @theme
- Static export builds successfully with `npm run build`
</success_criteria>

<output>
After completion, create `.planning/phases/06-frontend-foundation/06-01-SUMMARY.md`
</output>
